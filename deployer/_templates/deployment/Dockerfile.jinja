FROM python:3.10-slim-buster

ARG PROJECT_ID
ARG GCP_REGION
ARG GAR_LOCATION
ARG GAR_PIPELINES_REPO_ID
ARG VERTEX_STAGING_BUCKET_NAME
ARG VERTEX_SERVICE_ACCOUNT

ENV PROJECT_ID=${PROJECT_ID}
ENV GCP_REGION=${GCP_REGION}
ENV GAR_LOCATION=${GAR_LOCATION}
ENV GAR_PIPELINES_REPO_ID=${GAR_PIPELINES_REPO_ID}
ENV VERTEX_STAGING_BUCKET_NAME=${VERTEX_STAGING_BUCKET_NAME}
ENV VERTEX_SERVICE_ACCOUNT=${VERTEX_SERVICE_ACCOUNT}

WORKDIR /app

COPY requirements.txt .
COPY requirements-vertex.txt .
RUN python3 -m pip install --upgrade pip
RUN python3 -m pip install -r requirements-vertex.txt

ENV PYTHONPATH "${PYTHONPATH}:."

COPY ./vertex /app/vertex
